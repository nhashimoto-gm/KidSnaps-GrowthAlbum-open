const translations={en:{"nav-gallery":"Gallery","nav-upload":"Upload","nav-refresh-exif":"Refresh EXIF","nav-admin-mode":"Mode","admin-mode-admin":"Admin","admin-mode-user":"User","admin-password-modal-title":"Administrator Authentication","admin-password-info":"Please enter the administrator password to switch to admin mode.","admin-password-label":"Administrator Password","admin-password-placeholder":"Enter password","admin-password-submit":"Enable Admin Mode","admin-password-error":"Incorrect password.","page-title":"Media Gallery","page-subtitle":"View uploaded photos and videos","media-count-format":"{count} items","upload-button":"Upload Media","filter-label":"Filter","filter-all":"All","filter-image":"Photos Only","filter-video":"Videos Only","search-label":"Search","search-placeholder":"Search by title, description, filename...","no-media-title":"No Media Files","no-media-text":"No photos or videos have been uploaded yet.","first-upload":"Upload Your First Media","upload-modal-title":"Media Upload","file-select":"Select File","file-info":"Supported formats: JPEG, PNG, GIF, HEIC, MP4, MOV, AVI (Max 500MB per file, multiple files allowed)","title-label":"Title","title-placeholder":"e.g., Family Trip 2024","description-label":"Description","description-placeholder":"Enter a description of this media...",cancel:"Cancel",upload:"Upload","view-button":"View","image-badge":"Image","video-badge":"Video","modal-filename":"Filename:","modal-size":"Size:","modal-uploaded":"Uploaded:","modal-format":"Format:","exif-datetime":"Taken:","exif-location":"Location:","exif-camera":"Camera:","exif-details":"EXIF Details","modal-title":"Title","modal-description":"Description","footer-tagline":"Capture precious memories and watch your children grow","file-not-selected":"Click to select files","files-selected":"{count} file(s) selected","selected-files-header":"Selected Files: {count}","file-size-error":"File size is too large","total-items":"Total {count} items","page-of-pages":"Page {current} of {total}","pagination-previous":"Previous","pagination-next":"Next","pagination-current":"(current page)","pagination-info":"{start} - {end} of {total} items","duplicate-warning-title":"Duplicate Files Found","duplicate-already-uploaded":"is already uploaded","duplicate-upload-date":"Upload date","duplicate-auto-excluded":"Duplicate files will be automatically excluded.","duplicate-reselect-hint":"To upload anyway, please reselect the files.","duplicate-checking":"Checking for duplicates...","duplicate-check-status":"Checking {filename}... ({current}/{total})","duplicate-count-suffix":"{count} instance(s)","rotation-label":"Rotation:","rotate-left":"Rotate Left","rotate-right":"Rotate Right","save-rotation":"Save Rotation","rotation-changed":"(Changed)","rotation-saved":"Saved!","rotation-save-error":"Failed to save",converting:"Converting...",uploading:"Upload","file-size-error-alert":"Files over 500MB are included. Please reselect the files.","please-select-file":"Please select a file.","file-size-over-100mb":"The following files exceed 500MB:","preparing-upload":"Preparing upload...","generating-thumbnail":"Generating thumbnail...","upload-error":"An error occurred during upload: ","delete-confirm":'Are you sure you want to delete "{filename}"?\nThis action cannot be undone.',"heic-conversion-failed":"Failed to convert {filename}. Will upload the original file.","uploading-count":"Uploading {current}/{total}...",saving:"Saving...","media-load-error":"Media load error: ","upload-success":"Media file uploaded successfully!","upload-partial":"Some files were uploaded.","delete-success":"Media file deleted.","media-data-load-failed":"Failed to load media data.","page-title-gallery":"Gallery","sort-label":"Sort by","sort-upload-date-desc":"Upload Date (Newest)","sort-upload-date-asc":"Upload Date (Oldest)","sort-exif-datetime-desc":"Taken Date (Newest)","sort-exif-datetime-asc":"Taken Date (Oldest)","sort-location":"Location Name","sort-filename-asc":"Filename (A-Z)","sort-filename-desc":"Filename (Z-A)","refresh-exif-button":"Refresh EXIF","refresh-exif-modal-title":"EXIF Data Refresh","refresh-exif-description":"Re-extract EXIF information (capture date, GPS location, camera info, etc.) from all existing media files and update the database.","refresh-exif-warning":"This process may take some time. Please do not close this window during processing.","refresh-exif-progress":"Processing...","refresh-exif-total":"Total","refresh-exif-processed":"Processed","refresh-exif-updated":"Updated","refresh-exif-errors":"Errors","refresh-exif-complete":"EXIF data refresh completed.","refresh-exif-summary":"Processing Results","refresh-exif-files":"file(s)","refresh-exif-elapsed":"Elapsed Time","refresh-exif-seconds":"seconds","refresh-exif-start":"Start Refresh","refresh-exif-reload":"Reload Page","refresh-exif-cancel-confirm":"Are you sure you want to cancel the EXIF refresh process?","refresh-exif-cancelled":"EXIF refresh has been cancelled","refresh-exif-no-files":"No files to process","refresh-exif-error":"An error occurred: ","refresh-exif-cancelling":"Cancelling...","reading-exif-info":"Reading EXIF information...","not-set":"Not set","photo-date-save":"Save","edit-photo-date":"Edit Photo Date","saved-successfully":"‚úì Saved","update-photo-date-error":"Failed to save photo date","save-failed":"Failed to save","saving-in-progress":"Saving...","edit-metadata":"Edit Metadata","location-placeholder":"e.g., Shibuya, Tokyo",latitude:"Latitude",longitude:"Longitude","latitude-placeholder":"e.g., 35.658581","longitude-placeholder":"e.g., 139.745438",save:"Save","update-metadata-error":"Failed to update metadata","refresh-exif-already-running":"EXIF refresh is already running","refresh-exif-start-failed":"Failed to start","refresh-exif-file-list-failed":"Failed to get file list","duplicate-check-file-load-failed":"Failed to load file","duplicate-check-failed":"Duplicate check failed","write-exif-to-file":"Write EXIF to File","write-exif-confirm":"Write the current metadata as EXIF data to the image file?\n\nThis will physically modify the image file.","write-exif-success":"EXIF data has been written to the file","write-exif-error":"Failed to write EXIF data to file","write-exif-only-jpeg":"Only JPEG files are supported","write-exif-writing":"Writing EXIF data..."},ja:{"nav-gallery":"„ÇÆ„É£„É©„É™„Éº","nav-upload":"„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ","nav-refresh-exif":"EXIFÊ¥óÊõø","nav-admin-mode":"„É¢„Éº„Éâ","admin-mode-admin":"ÁÆ°ÁêÜËÄÖ","admin-mode-user":"„É¶„Éº„Ç∂„Éº","admin-password-modal-title":"ÁÆ°ÁêÜËÄÖ„É¢„Éº„ÉâË™çË®º","admin-password-info":"ÁÆ°ÁêÜËÄÖ„É¢„Éº„Éâ„Å´Âàá„ÇäÊõø„Åà„Çã„Å´„ÅØ„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ","admin-password-label":"ÁÆ°ÁêÜËÄÖ„Éë„Çπ„ÉØ„Éº„Éâ","admin-password-placeholder":"„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ","admin-password-submit":"ÁÆ°ÁêÜËÄÖ„É¢„Éº„ÉâON","admin-password-error":"„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ","page-title":"„É°„Éá„Ç£„Ç¢„ÇÆ„É£„É©„É™„Éº","page-subtitle":"„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åó„ÅüÂÜôÁúü„Å®ÂãïÁîª„ÇíÈñ≤Ë¶ß„Åß„Åç„Åæ„Åô","media-count-format":"{count} ‰ª∂","upload-button":"„É°„Éá„Ç£„Ç¢„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ","filter-label":"„Éï„Ç£„É´„Çø„Éº","filter-all":"„Åô„Åπ„Å¶","filter-image":"ÂÜôÁúü„ÅÆ„Åø","filter-video":"ÂãïÁîª„ÅÆ„Åø","search-label":"Ê§úÁ¥¢","search-placeholder":"„Çø„Ç§„Éà„É´„ÄÅË™¨Êòé„ÄÅ„Éï„Ç°„Ç§„É´Âêç„ÅßÊ§úÁ¥¢...","no-media-title":"„É°„Éá„Ç£„Ç¢„Éï„Ç°„Ç§„É´„Åå„ÅÇ„Çä„Åæ„Åõ„Çì","no-media-text":"„Åæ„Å†ÂÜôÁúü„ÇÑÂãïÁîª„Åå„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ","first-upload":"ÊúÄÂàù„ÅÆ„É°„Éá„Ç£„Ç¢„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ","upload-modal-title":"„É°„Éá„Ç£„Ç¢„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ","file-select":"„Éï„Ç°„Ç§„É´ÈÅ∏Êäû","file-info":"ÂØæÂøúÂΩ¢Âºè: JPEG, PNG, GIF, HEIC, MP4, MOV, AVI (ÂêÑ„Éï„Ç°„Ç§„É´ÊúÄÂ§ß500MB„ÄÅË§áÊï∞ÈÅ∏ÊäûÂèØ)","title-label":"„Çø„Ç§„Éà„É´","title-placeholder":"‰æã: ÂÆ∂ÊóèÊóÖË°å 2024","description-label":"Ë™¨Êòé","description-placeholder":"„Åì„ÅÆ„É°„Éá„Ç£„Ç¢„Å´„Å§„ÅÑ„Å¶„ÅÆË™¨Êòé„ÇíÂÖ•Âäõ...",cancel:"„Ç≠„É£„É≥„Çª„É´",upload:"„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ","view-button":"Ë°®Á§∫","image-badge":"ÁîªÂÉè","video-badge":"ÂãïÁîª","modal-filename":"„Éï„Ç°„Ç§„É´Âêç:","modal-size":"„Çµ„Ç§„Ç∫:","modal-uploaded":"„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ:","modal-format":"ÂΩ¢Âºè:","exif-datetime":"ÊíÆÂΩ±Êó•ÊôÇ:","exif-location":"‰ΩçÁΩÆÊÉÖÂ†±:","exif-camera":"„Ç´„É°„É©:","exif-details":"EXIFÊÉÖÂ†±","modal-title":"„Çø„Ç§„Éà„É´","modal-description":"Ë™¨Êòé","footer-tagline":"Â§ßÂàá„Å™ÊÄù„ÅÑÂá∫„ÇíË®òÈå≤„Åó„ÄÅÊàêÈï∑„ÇíË¶ãÂÆà„Çã„Ç¢„É´„Éê„É†","file-not-selected":"„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû","files-selected":"{count} ÂÄã„ÅÆ„Éï„Ç°„Ç§„É´„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Åæ„Åô","selected-files-header":"ÈÅ∏Êäû„Åï„Çå„Åü„Éï„Ç°„Ç§„É´: {count}‰ª∂","file-size-error":"„Éï„Ç°„Ç§„É´„Çµ„Ç§„Ç∫„ÅåÂ§ß„Åç„Åô„Åé„Åæ„Åô","total-items":"ÂÖ®{count}‰ª∂","page-of-pages":"{current} / {total} „Éö„Éº„Ç∏","pagination-previous":"Ââç„Å∏","pagination-next":"Ê¨°„Å∏","pagination-current":"(ÁèæÂú®„ÅÆ„Éö„Éº„Ç∏)","pagination-info":"{start} - {end} ‰ª∂ÁõÆ / ÂÖ® {total} ‰ª∂","duplicate-warning-title":"ÈáçË§á„Éï„Ç°„Ç§„É´„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åó„Åü","duplicate-already-uploaded":"„ÅØÊó¢„Å´„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÊ∏à„Åø„Åß„Åô","duplicate-upload-date":"ÁôªÈå≤Êó•","duplicate-auto-excluded":"ÈáçË§á„Éï„Ç°„Ç§„É´„ÅØËá™ÂãïÁöÑ„Å´Èô§Â§ñ„Åï„Çå„Åæ„Åô„ÄÇ","duplicate-reselect-hint":"„Åù„Çå„Åß„ÇÇ„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åô„ÇãÂ†¥Âêà„ÅØ„ÄÅ„Éï„Ç°„Ç§„É´„ÇíÂÜçÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ","duplicate-checking":"ÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØ‰∏≠...","duplicate-check-status":"{filename} „Çí„ÉÅ„Çß„ÉÉ„ÇØ‰∏≠... ({current}/{total})","duplicate-count-suffix":"{count}ÂÄã","rotation-label":"ÂõûËª¢:","rotate-left":"Â∑¶„Å´ÂõûËª¢","rotate-right":"Âè≥„Å´ÂõûËª¢","save-rotation":"ÂõûËª¢„Çí‰øùÂ≠ò","rotation-changed":"(Â§âÊõ¥Ê∏à„Åø)","rotation-saved":"‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ","rotation-save-error":"‰øùÂ≠ò„Å´Â§±Êïó",converting:"Â§âÊèõ‰∏≠...",uploading:"„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ","file-size-error-alert":"500MB„ÇíË∂Ö„Åà„Çã„Éï„Ç°„Ç§„É´„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû„ÅóÁõ¥„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ","please-select-file":"„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ","file-size-over-100mb":"‰ª•‰∏ã„ÅÆ„Éï„Ç°„Ç§„É´„ÅØ500MB„ÇíË∂Ö„Åà„Å¶„ÅÑ„Åæ„Åô:","preparing-upload":"„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÊ∫ñÂÇô‰∏≠...","generating-thumbnail":"„Çµ„É†„Éç„Ç§„É´ÁîüÊàê‰∏≠...","upload-error":"„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ","delete-confirm":"„Äå{filename}„Äç„ÇíÂâäÈô§„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü\n„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ","heic-conversion-failed":"{filename} „ÅÆÂ§âÊèõ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇÂÖÉ„ÅÆ„Éï„Ç°„Ç§„É´„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åó„Åæ„Åô„ÄÇ","uploading-count":"{current}/{total}‰ª∂„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ‰∏≠...",saving:"‰øùÂ≠ò‰∏≠...","media-load-error":"„É°„Éá„Ç£„Ç¢„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº: ","upload-success":"„É°„Éá„Ç£„Ç¢„Éï„Ç°„Ç§„É´„ÅåÊ≠£Â∏∏„Å´„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åï„Çå„Åæ„Åó„ÅüÔºÅ","upload-partial":"‰∏ÄÈÉ®„ÅÆ„Éï„Ç°„Ç§„É´„Åå„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åï„Çå„Åæ„Åó„Åü„ÄÇ","delete-success":"„É°„Éá„Ç£„Ç¢„Éï„Ç°„Ç§„É´„ÅåÂâäÈô§„Åï„Çå„Åæ„Åó„Åü„ÄÇ","media-data-load-failed":"„É°„Éá„Ç£„Ç¢„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ","page-title-gallery":"„ÇÆ„É£„É©„É™„Éº","sort-label":"‰∏¶„Å≥Êõø„Åà","sort-upload-date-desc":"„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÊó•ÔºàÊñ∞„Åó„ÅÑÈ†ÜÔºâ","sort-upload-date-asc":"„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÊó•ÔºàÂè§„ÅÑÈ†ÜÔºâ","sort-exif-datetime-desc":"ÊíÆÂΩ±Êó•ÔºàÊñ∞„Åó„ÅÑÈ†ÜÔºâ","sort-exif-datetime-asc":"ÊíÆÂΩ±Êó•ÔºàÂè§„ÅÑÈ†ÜÔºâ","sort-location":"Â†¥ÊâÄÔºàÂú∞ÂêçÈ†ÜÔºâ","sort-filename-asc":"„Éï„Ç°„Ç§„É´ÂêçÔºàÊòáÈ†ÜÔºâ","sort-filename-desc":"„Éï„Ç°„Ç§„É´ÂêçÔºàÈôçÈ†ÜÔºâ","refresh-exif-button":"EXIFÊ¥óÊõø","refresh-exif-modal-title":"EXIFÊÉÖÂ†±Ê¥óÊõø","refresh-exif-description":"Êó¢Â≠ò„ÅÆÂÖ®„É°„Éá„Ç£„Ç¢„Éï„Ç°„Ç§„É´„ÅÆEXIFÊÉÖÂ†±ÔºàÊíÆÂΩ±Êó•ÊôÇ„ÄÅGPS‰ΩçÁΩÆÊÉÖÂ†±„ÄÅ„Ç´„É°„É©ÊÉÖÂ†±„Å™„Å©Ôºâ„ÇíÂÜçÊäΩÂá∫„Åó„Å¶„Éá„Éº„Çø„Éô„Éº„Çπ„ÇíÊõ¥Êñ∞„Åó„Åæ„Åô„ÄÇ","refresh-exif-warning":"Âá¶ÁêÜ„Å´„ÅØÊôÇÈñì„Åå„Åã„Åã„ÇãÂ†¥Âêà„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÂá¶ÁêÜ‰∏≠„ÅØ„Åì„ÅÆ„Ç¶„Ç£„É≥„Éâ„Ç¶„ÇíÈñâ„Åò„Å™„ÅÑ„Åß„Åè„Å†„Åï„ÅÑ„ÄÇ","refresh-exif-progress":"Âá¶ÁêÜ‰∏≠...","refresh-exif-total":"ÂÖ®‰Ωì","refresh-exif-processed":"Âá¶ÁêÜÊ∏à","refresh-exif-updated":"Êõ¥Êñ∞","refresh-exif-errors":"„Ç®„É©„Éº","refresh-exif-complete":"EXIFÊÉÖÂ†±„ÅÆÊ¥óÊõø„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü„ÄÇ","refresh-exif-summary":"Âá¶ÁêÜÁµêÊûú","refresh-exif-files":"‰ª∂","refresh-exif-elapsed":"ÁµåÈÅéÊôÇÈñì","refresh-exif-seconds":"Áßí","refresh-exif-start":"Ê¥óÊõøÈñãÂßã","refresh-exif-reload":"„Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø","refresh-exif-cancel-confirm":"EXIFÊ¥óÊõøÂá¶ÁêÜ„Çí‰∏≠Ê≠¢„Åó„Åæ„Åô„ÅãÔºü","refresh-exif-cancelled":"EXIFÊ¥óÊõø„Åå„Ç≠„É£„É≥„Çª„É´„Åï„Çå„Åæ„Åó„Åü","refresh-exif-no-files":"Âá¶ÁêÜÂØæË±°„ÅÆ„Éï„Ç°„Ç§„É´„Åå„ÅÇ„Çä„Åæ„Åõ„Çì","refresh-exif-error":"„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ","refresh-exif-cancelling":"„Ç≠„É£„É≥„Çª„É´‰∏≠...","reading-exif-info":"EXIFÊÉÖÂ†±„ÇíË™≠„ÅøÂèñ„Çä‰∏≠...","not-set":"Êú™Ë®≠ÂÆö","photo-date-save":"‰øùÂ≠ò","edit-photo-date":"ÊíÆÂΩ±Êó•„ÇíÁ∑®ÈõÜ","saved-successfully":"‚úì ‰øùÂ≠ò„Åó„Åæ„Åó„Åü","update-photo-date-error":"ÊíÆÂΩ±Êó•„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü","save-failed":"‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü","saving-in-progress":"‰øùÂ≠ò‰∏≠...","edit-metadata":"„É°„Çø„Éá„Éº„Çø„ÇíÁ∑®ÈõÜ","location-placeholder":"‰æã: Êù±‰∫¨ÈÉΩÊ∏ãË∞∑Âå∫",latitude:"Á∑ØÂ∫¶",longitude:"ÁµåÂ∫¶","latitude-placeholder":"‰æã: 35.658581","longitude-placeholder":"‰æã: 139.745438",save:"‰øùÂ≠ò","update-metadata-error":"„É°„Çø„Éá„Éº„Çø„ÅÆÊõ¥Êñ∞„Å´Â§±Êïó„Åó„Åæ„Åó„Åü","refresh-exif-already-running":"EXIFÊ¥óÊõø„ÅØÊó¢„Å´ÂÆüË°å‰∏≠„Åß„Åô","refresh-exif-start-failed":"ÈñãÂßã„Å´Â§±Êïó„Åó„Åæ„Åó„Åü","refresh-exif-file-list-failed":"„Éï„Ç°„Ç§„É´„É™„Çπ„ÉàÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü","duplicate-check-file-load-failed":"„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü","duplicate-check-failed":"ÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü","write-exif-to-file":"EXIF„Çí„Éï„Ç°„Ç§„É´„Å´Êõ∏„ÅçËæº„ÇÄ","write-exif-confirm":"ÁèæÂú®„ÅÆ„É°„Çø„Éá„Éº„Çø„ÇíEXIFÊÉÖÂ†±„Å®„Åó„Å¶ÁîªÂÉè„Éï„Ç°„Ç§„É´„Å´Êõ∏„ÅçËæº„Åø„Åæ„Åô„ÅãÔºü\n\n‚ÄªÁîªÂÉè„Éï„Ç°„Ç§„É´Ëá™‰Ωì„ÇíÁâ©ÁêÜÁöÑ„Å´Â§âÊõ¥„Åó„Åæ„Åô„ÄÇ","write-exif-success":"EXIF„Éá„Éº„Çø„Çí„Éï„Ç°„Ç§„É´„Å´Êõ∏„ÅçËæº„Åø„Åæ„Åó„Åü","write-exif-error":"EXIF„Éá„Éº„Çø„ÅÆÊõ∏„ÅçËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü","write-exif-only-jpeg":"JPEG„Éï„Ç°„Ç§„É´„ÅÆ„Åø„Çµ„Éù„Éº„Éà„Åï„Çå„Å¶„ÅÑ„Åæ„Åô","write-exif-writing":"EXIFÊõ∏„ÅçËæº„Åø‰∏≠..."}};let currentTheme=localStorage.getItem("kidsnaps-theme")||"dark";function toggleLanguage(){currentLanguage="en"===currentLanguage?"ja":"en",localStorage.setItem("kidsnaps-language",currentLanguage),applyLanguage()}function t(e){return translations[currentLanguage]&&translations[currentLanguage][e]?translations[currentLanguage][e]:e}function applyLanguage(){const e=translations[currentLanguage];document.querySelectorAll("[data-i18n]").forEach(t=>{const a=t.getAttribute("data-i18n");if("total-items"===a&&t.dataset.count)t.textContent=e[a].replace("{count}",t.dataset.count);else if("page-of-pages"===a&&t.dataset.current&&t.dataset.total)t.textContent=e[a].replace("{current}",t.dataset.current).replace("{total}",t.dataset.total);else if("pagination-info"===a&&t.dataset.start&&t.dataset.end&&t.dataset.total)t.textContent=e[a].replace("{start}",t.dataset.start).replace("{end}",t.dataset.end).replace("{total}",t.dataset.total);else if("media-count"===a){const a=t.textContent.match(/\d+/);a&&e["media-count-format"]&&(t.textContent=e["media-count-format"].replace("{count}",a[0]))}else e[a]&&(t.textContent=e[a])}),document.querySelectorAll("[data-i18n-title]").forEach(t=>{const a=t.getAttribute("data-i18n-title");e[a]&&t.setAttribute("title",e[a])}),document.querySelectorAll("[data-i18n-placeholder]").forEach(t=>{const a=t.getAttribute("data-i18n-placeholder");e[a]&&t.setAttribute("placeholder",e[a])});const t=document.getElementById("langToggleText");t&&(t.textContent="en"===currentLanguage?"JP":"EN");const a=document.querySelector("[data-page-title]");if(a){const t=a.getAttribute("data-page-title");e[t]&&(document.title=`${e[t]} - KidSnaps Growth Album`)}const n=document.getElementById("fileInputLabel"),i=document.getElementById("mediaFile");if(n&&i){const t=i.files;0===t.length?n.innerHTML=`<i class="bi bi-cloud-upload"></i><span>${e["file-not-selected"]}</span>`:1===t.length||(n.innerHTML=`<i class="bi bi-check-circle-fill"></i><span>${e["files-selected"].replace("{count}",t.length)}</span>`)}console.log("Language changed to:",currentLanguage)}function toggleTheme(){currentTheme="light"===currentTheme?"dark":"light",localStorage.setItem("kidsnaps-theme",currentTheme),applyTheme()}function applyTheme(){document.documentElement.setAttribute("data-theme",currentTheme);const e=document.getElementById("themeIcon");e&&(e.className="dark"===currentTheme?"bi bi-sun-fill":"bi bi-moon-fill"),console.log("Theme changed to:",currentTheme)}function cleanupSuccessParameter(){const e=new URLSearchParams(window.location.search);let t=!1;if(e.has("success")&&(e.delete("success"),t=!0),e.has("error")&&(e.delete("error"),t=!0),t){const t=e.toString()?window.location.pathname+"?"+e.toString():window.location.pathname;window.history.replaceState({},"",t)}}function initUploadForm(){const e=document.getElementById("uploadForm"),t=document.getElementById("uploadBtn"),a=document.getElementById("uploadProgress"),n=document.getElementById("mediaFile"),i=document.getElementById("fileList");e&&(n&&n.addEventListener("change",async function(e){let t=Array.from(e.target.files);const a=document.getElementById("fileInputLabel"),o=document.getElementById("uploadBtn"),l=translations[currentLanguage];if(0===t.length){i&&(i.innerHTML=""),a&&(a.innerHTML=`<i class="bi bi-cloud-upload"></i><span data-i18n="file-not-selected">${l["file-not-selected"]}</span>`,a.classList.remove("file-selected"));const e=document.getElementById("title");return void(e&&e.dataset.autoGenerated&&(e.value="",delete e.dataset.autoGenerated))}if(o&&(o.disabled=!0,o.innerHTML=`<span class="spinner-border spinner-border-sm me-2"></span>${l.converting}`),t=await convertHeicFilesToJpeg(t),o&&(o.disabled=!1,o.innerHTML=`<i class="bi bi-cloud-upload"></i> <span data-i18n="upload">${l.upload}</span>`,applyLanguage()),a&&(1===t.length?a.innerHTML=`<i class="bi bi-check-circle-fill"></i><span>${escapeHtml(t[0].name)}</span>`:a.innerHTML=`<i class="bi bi-check-circle-fill"></i><span>${l["files-selected"].replace("{count}",t.length)}</span>`,a.classList.add("file-selected")),i){let e='<div class="file-list-display py-2 mb-0">';e+=`<strong><i class="bi bi-files"></i> ${l["selected-files-header"].replace("{count}",t.length)}</strong><ul class="mb-0 mt-2 small">`;let a=!1;const o=524288e3;for(const n of t){const t=formatFileSize(n.size);n.size>o?(a=!0,e+=`<li class="text-danger"><strong>${escapeHtml(n.name)}</strong> (${t}) - ${l["file-size-error"]}</li>`):e+=`<li>${escapeHtml(n.name)} (${t})</li>`}if(e+="</ul></div>",i.innerHTML=e,a)return alert(l["file-size-error-alert"]),n.value="",void(i.innerHTML="")}if(t.length>0&&t[0].type.startsWith("image/"))try{await generateTitleFromExif(t[0])}catch(e){console.error("EXIFÊÉÖÂ†±„ÅÆË™≠„ÅøÂèñ„Çä„Ç®„É©„Éº:",e)}console.log(`${t.length}ÂÄã„ÅÆ„Éï„Ç°„Ç§„É´„ÅåÈÅ∏Êäû„Åï„Çå„Åæ„Åó„Åü„ÄÇ`);const r=t.filter(e=>e.type.startsWith("video/"));if(r.length>0){console.log(`${r.length}ÂÄã„ÅÆÂãïÁîª„Éï„Ç°„Ç§„É´„ÅÆ„Çµ„É†„Éç„Ç§„É´„ÇíÁîüÊàê‰∏≠...`);try{await generateMultipleVideoThumbnails(r)}catch(e){console.error("„Çµ„É†„Éç„Ç§„É´ÁîüÊàê„Ç®„É©„Éº:",e)}}}),e.addEventListener("submit",async function(e){e.preventDefault();const n=document.getElementById("mediaFile"),i=document.getElementById("title"),o=document.getElementById("description");if(!n||!n.files||0===n.files.length){const e=translations[currentLanguage];return void alert(e["please-select-file"])}const l=translations[currentLanguage],r=Array.from(n.files),s=r.filter(e=>e.size>524288e3);if(s.length>0)alert(`${l["file-size-over-100mb"]}\n${s.map(e=>e.name).join("\n")}`);else{if(t&&(t.disabled=!0,t.innerHTML=`<span class="spinner-border spinner-border-sm me-2"></span>${l["preparing-upload"]}`),a){a.classList.remove("d-none");const e=a.querySelector(".progress-bar");e&&(e.style.width="0%",e.textContent="0%")}try{const e=new Map,a=r.filter(e=>e.type.startsWith("video/"));if(a.length>0){t&&(t.innerHTML=`<span class="spinner-border spinner-border-sm me-2"></span>${l["generating-thumbnail"]}`),console.log(`[„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ] ${a.length}ÂÄã„ÅÆÂãïÁîª„ÅÆ„Çµ„É†„Éç„Ç§„É´„ÇíÁîüÊàê„Åó„Åæ„Åô`);for(const t of a)try{const a=await generateSingleVideoThumbnail(t),n=new FileReader,i=await new Promise((e,t)=>{n.onloadend=()=>e(n.result),n.onerror=t,n.readAsDataURL(a)});e.set(t.name,i),console.log(`[„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ] „Çµ„É†„Éç„Ç§„É´ÁîüÊàêÊàêÂäü: ${t.name}`)}catch(e){console.warn(`[„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ] „Çµ„É†„Éç„Ç§„É´ÁîüÊàêÂ§±Êïó (${t.name}):`,e),console.warn(`[„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ] „Çµ„É†„Éç„Ç§„É´„Å™„Åó„ÅßÁ∂öË°å„Åó„Åæ„Åô: ${t.name}`)}console.log(`[„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ] „Çµ„É†„Éç„Ç§„É´ÁîüÊàêÂÆå‰∫Ü: ${e.size}/${a.length}ÂÄãÊàêÂäü`)}const n=new Map,s=r.filter(e=>e.type.startsWith("image/"));if(s.length>0){t&&(t.innerHTML=`<span class="spinner-border spinner-border-sm me-2"></span>${l["reading-exif-info"]}`),console.log(`[„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ] ${s.length}ÂÄã„ÅÆÁîªÂÉè„ÅÆEXIFÊÉÖÂ†±„ÇíÊäΩÂá∫„Åó„Åæ„Åô`);for(const e of s)try{const t=await readExifFromFile(e);if(t){let a=null,i=null;t.GPSLatitude&&t.GPSLongitude&&(a=convertDMSToDD(t.GPSLatitude,t.GPSLatitudeRef),i=convertDMSToDD(t.GPSLongitude,t.GPSLongitudeRef)),n.set(e.name,{datetime:t.DateTimeOriginal||t.DateTime||t.DateTimeDigitized||null,latitude:a,longitude:i,camera_make:t.Make||null,camera_model:t.Model||null,orientation:t.Orientation||1}),console.log(`[„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ] EXIFÊäΩÂá∫ÊàêÂäü: ${e.name}`)}}catch(t){console.warn(`[„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ] EXIFÊäΩÂá∫Â§±Êïó (${e.name}):`,t)}console.log(`[„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ] EXIFÊäΩÂá∫ÂÆå‰∫Ü: ${n.size}/${s.length}ÂÄãÊàêÂäü`)}const d=i?i.value:"",c=o?o.value:"",u=await uploadMultipleFiles(r,d,c,e,n);0===u.errors.length?window.location.href="index.php?success=upload":u.success.length>0?(sessionStorage.setItem("uploadErrors",JSON.stringify(u.errors)),window.location.href="index.php?success=partial"):(sessionStorage.setItem("uploadErrors",JSON.stringify(u.errors)),window.location.href="index.php?error=upload")}catch(e){console.error("„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Ç®„É©„Éº:",e),alert(l["upload-error"]+e.message),t&&(t.disabled=!1,t.innerHTML=`<i class="bi bi-cloud-upload me-2"></i>${l.uploading}`),a&&a.classList.add("d-none")}}}))}async function generateTitleFromExif(e){const t=document.getElementById("title");if(!t)return;if(t.value&&!t.dataset.autoGenerated)return;try{const a=await readExifFromFile(e);if(!a)return;let n="";if(a.DateTime||a.DateTimeOriginal){const e=parseDateTimeFromExif(a.DateTimeOriginal||a.DateTime);if(e){const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0");n=`${t}/${a}/${String(e.getDate()).padStart(2,"0")}`}}if(a.GPSLatitude&&a.GPSLongitude){const e=convertDMSToDD(a.GPSLatitude,a.GPSLatitudeRef),t=convertDMSToDD(a.GPSLongitude,a.GPSLongitudeRef);e&&t&&(n&&(n+=" - "),n+=`üìç ${e.toFixed(4)}, ${t.toFixed(4)}`)}n&&(t.value=n,t.dataset.autoGenerated="true",t.classList.add("auto-generated-title"),t.addEventListener("input",function e(){delete t.dataset.autoGenerated,t.classList.remove("auto-generated-title"),t.removeEventListener("input",e)},{once:!0}))}catch(e){console.error("EXIFË™≠„ÅøÂèñ„Çä„Ç®„É©„Éº:",e)}const a=document.getElementById("uploadModal");a&&a.addEventListener("hide.bs.modal",function(){document.activeElement&&a.contains(document.activeElement)&&document.activeElement.blur()})}function readExifFromFile(e){return new Promise((t,a)=>{if("undefined"==typeof EXIF)return console.warn("EXIF.js library not loaded"),void t(null);const n=new FileReader;n.onload=function(e){try{const a=new Image;a.onload=function(){try{EXIF.getData(a,function(){const e=EXIF.getAllTags(this);if(!e||0===Object.keys(e).length)return void t(null);const a={DateTime:e.DateTime,DateTimeOriginal:e.DateTimeOriginal,DateTimeDigitized:e.DateTimeDigitized,GPSLatitude:e.GPSLatitude,GPSLatitudeRef:e.GPSLatitudeRef,GPSLongitude:e.GPSLongitude,GPSLongitudeRef:e.GPSLongitudeRef,Make:e.Make,Model:e.Model,Orientation:e.Orientation};console.log("EXIF data extracted:",a),t(a)})}catch(e){console.error("EXIF parsing error:",e),t(null)}},a.onerror=function(){console.error("Failed to load image"),t(null)},a.src=e.target.result}catch(e){a(e)}},n.onerror=a,n.readAsDataURL(e)})}function parseDateTimeFromExif(e){if(!e)return null;const t=e.split(" ");if(2!==t.length)return null;const a=t[0].split(":"),n=t[1].split(":");return 3!==a.length||3!==n.length?null:new Date(parseInt(a[0]),parseInt(a[1])-1,parseInt(a[2]),parseInt(n[0]),parseInt(n[1]),parseInt(n[2]))}function convertDMSToDD(e,t){if(!e||e.length<3)return null;let a=e[0]+e[1]/60+e[2]/3600;return"S"!==t&&"W"!==t||(a=-a),a}function generateVideoThumbnail(e){return new Promise((t,a)=>{const n=document.createElement("video"),i=document.createElement("canvas"),o=i.getContext("2d");n.preload="metadata",n.muted=!0,n.playsInline=!0,n.onloadeddata=function(){n.currentTime=Math.min(1,n.duration/2)},n.onseeked=function(){const e=Math.min(800/n.videoWidth,1);i.width=n.videoWidth*e,i.height=n.videoHeight*e,o.drawImage(n,0,0,i.width,i.height),i.toBlob(function(e){if(e){const a=new File([e],"thumbnail.jpg",{type:"image/jpeg"}),n=document.getElementById("videoThumbnail");if(n){const e=new DataTransfer;e.items.add(a),n.files=e.files}console.log("„Çµ„É†„Éç„Ç§„É´ÁîüÊàêÂÆå‰∫Ü:",formatFileSize(e.size)),t(e)}else a(new Error("„Çµ„É†„Éç„Ç§„É´ÁîüÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"));URL.revokeObjectURL(n.src)},"image/jpeg",.85)},n.onerror=function(){a(new Error("ÂãïÁîª„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")),URL.revokeObjectURL(n.src)},n.src=URL.createObjectURL(e)})}async function generateMultipleVideoThumbnails(e){const t=[];for(const a of e)try{const e=await generateSingleVideoThumbnail(a);t.push(e)}catch(e){console.error(`„Çµ„É†„Éç„Ç§„É´ÁîüÊàê„Ç®„É©„Éº (${a.name}):`,e),t.push(null)}const a=document.getElementById("videoThumbnail");if(a){const e=new DataTransfer;t.forEach((t,a)=>{if(t){const n=new File([t],`thumbnail_${a}.jpg`,{type:"image/jpeg"});e.items.add(n)}}),a.files=e.files}console.log(`${t.filter(e=>null!==e).length}/${e.length} ÂÄã„ÅÆ„Çµ„É†„Éç„Ç§„É´ÁîüÊàêÂÆå‰∫Ü`)}function generateSingleVideoThumbnail(e){return new Promise((t,a)=>{console.log(`[„Çµ„É†„Éç„Ç§„É´ÁîüÊàê] ÈñãÂßã: ${e.name}`);const n=document.createElement("video"),i=document.createElement("canvas"),o=i.getContext("2d"),l=setTimeout(()=>{console.error(`[„Çµ„É†„Éç„Ç§„É´ÁîüÊàê] „Çø„Ç§„É†„Ç¢„Ç¶„Éà: ${e.name}`),URL.revokeObjectURL(n.src),a(new Error("„Çµ„É†„Éç„Ç§„É´ÁîüÊàê„Åå„Çø„Ç§„É†„Ç¢„Ç¶„Éà„Åó„Åæ„Åó„ÅüÔºà30ÁßíÔºâ"))},3e4),r=()=>{clearTimeout(l),URL.revokeObjectURL(n.src)};n.preload="metadata",n.muted=!0,n.playsInline=!0,n.crossOrigin="anonymous",n.onloadedmetadata=function(){console.log(`[„Çµ„É†„Éç„Ç§„É´ÁîüÊàê] „É°„Çø„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÂÆå‰∫Ü: ${e.name}, duration: ${n.duration}s`);try{if(!n.duration||n.duration===1/0||isNaN(n.duration))return console.warn(`[„Çµ„É†„Éç„Ç§„É´ÁîüÊàê] duration „Åå‰∏çÊ≠£: ${n.duration}`),r(),void a(new Error("ÂãïÁîª„ÅÆÈï∑„Åï„ÇíÂèñÂæó„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü"));n.currentTime=Math.min(1,n.duration/2)}catch(e){console.error("[„Çµ„É†„Éç„Ç§„É´ÁîüÊàê] currentTimeË®≠ÂÆö„Ç®„É©„Éº:",e),r(),a(e)}},n.onseeked=function(){console.log(`[„Çµ„É†„Éç„Ç§„É´ÁîüÊàê] „Ç∑„Éº„ÇØÂÆå‰∫Ü: ${e.name}`);try{const l=800,s=Math.min(l/n.videoWidth,1);i.width=n.videoWidth*s,i.height=n.videoHeight*s,o.drawImage(n,0,0,i.width,i.height),console.log(`[„Çµ„É†„Éç„Ç§„É´ÁîüÊàê] „Ç≠„É£„É≥„Éê„ÇπÊèèÁîªÂÆå‰∫Ü: ${i.width}x${i.height}`),i.toBlob(function(n){r(),n?(console.log(`[„Çµ„É†„Éç„Ç§„É´ÁîüÊàê] ÊàêÂäü: ${e.name}, size: ${n.size} bytes`),t(n)):(console.error("[„Çµ„É†„Éç„Ç§„É´ÁîüÊàê] BlobÁîüÊàêÂ§±Êïó"),a(new Error("„Çµ„É†„Éç„Ç§„É´ÁîüÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")))},"image/jpeg",.85)}catch(e){console.error("[„Çµ„É†„Éç„Ç§„É´ÁîüÊàê] ÊèèÁîª„Ç®„É©„Éº:",e),r(),a(e)}},n.onerror=function(t){console.error(`[„Çµ„É†„Éç„Ç§„É´ÁîüÊàê] ÂãïÁîªË™≠„ÅøËæº„Åø„Ç®„É©„Éº: ${e.name}`,t),r(),a(new Error("ÂãïÁîª„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"))};try{n.src=URL.createObjectURL(e),console.log(`[„Çµ„É†„Éç„Ç§„É´ÁîüÊàê] ÂãïÁîªË™≠„ÅøËæº„ÅøÈñãÂßã: ${e.name}`)}catch(e){console.error("[„Çµ„É†„Éç„Ç§„É´ÁîüÊàê] createObjectURL „Ç®„É©„Éº:",e),r(),a(e)}})}function initMediaViewer(){const e=document.getElementById("viewModal");e&&(e.addEventListener("hide.bs.modal",function(){document.activeElement&&e.contains(document.activeElement)&&document.activeElement.blur()}),e.addEventListener("hidden.bs.modal",function(){e.querySelectorAll("video").forEach(e=>{e.pause(),e.currentTime=0}),window.heicBlobUrls&&window.heicBlobUrls.length>0&&(window.heicBlobUrls.forEach(e=>{URL.revokeObjectURL(e)}),window.heicBlobUrls=[],console.log("HEIC Blob URLs„Çí„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó„Åó„Åæ„Åó„Åü"))}))}document.addEventListener("DOMContentLoaded",function(){console.log("KidSnaps Growth Album initialized"),applyLanguage(),applyTheme(),cleanupSuccessParameter(),initUploadForm(),initMediaViewer(),initTooltips()});let currentMedia=null,currentRotation=0;function viewMediaFromElement(e){try{const t=e.getAttribute("data-media");if(!t)return void console.error("data-media attribute not found");console.log("Attempting to parse media JSON:",t.substring(0,100)+"...");viewMedia(JSON.parse(t))}catch(t){console.error("Failed to parse media data:",t),console.error("Raw JSON string:",e.getAttribute("data-media"));const a=translations[currentLanguage];alert(a["media-data-load-failed"])}}async function viewMedia(e){const t=new bootstrap.Modal(document.getElementById("viewModal")),a=document.getElementById("viewModalLabel"),n=document.getElementById("viewModalBody"),i=document.getElementById("viewModalInfo");document.getElementById("rotationControls");currentMedia=e,currentRotation=e.rotation||0,e.exif_location_name?a.textContent=e.exif_location_name:e.exif_datetime?a.textContent=formatDate(e.exif_datetime):a.textContent=truncateFilename(e.filename);let o="";if("image"===e.file_type){const t=e.file_path.toLowerCase().match(/\.(heic|heif)$/);let a=escapeHtml(e.file_path);if(t){n.innerHTML='\n                <div class="text-center py-5">\n                    <div class="spinner-border text-primary" role="status">\n                        <span class="visually-hidden">Â§âÊèõ‰∏≠...</span>\n                    </div>\n                    <p class="mt-3">HEICÁîªÂÉè„ÇíÂ§âÊèõ‰∏≠...</p>\n                </div>\n            ';try{console.log("HEICÁîªÂÉè„ÇíÂ§âÊèõÈñãÂßã:",e.file_path);const t=await fetch(e.file_path);if(!t.ok)throw new Error("ÁîªÂÉè„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü");const n=await t.blob(),i=await heic2any({blob:n,toType:"image/jpeg",quality:.9}),o=URL.createObjectURL(i);a=o,window.heicBlobUrls||(window.heicBlobUrls=[]),window.heicBlobUrls.push(o),console.log("HEICÁîªÂÉèÂ§âÊèõÂÆå‰∫Ü:",o)}catch(t){console.error("HEICÂ§âÊèõ„Ç®„É©„Éº:",t),a=escapeHtml(e.file_path)}}o=`\n            <img src="${a}"\n                 alt="${escapeHtml(e.title||e.filename)}"\n                 class="img-fluid rounded rotatable-media rotate-${currentRotation}"\n                 id="currentMediaElement">\n        `}else if("video"===e.file_type){const t=e.thumbnail_path?`poster="${escapeHtml(e.thumbnail_path)}"`:"",a="video/quicktime"===e.mime_type||e.file_path.toLowerCase().endsWith(".mov")?`<source src="${escapeHtml(e.file_path)}">`:`<source src="${escapeHtml(e.file_path)}" type="${escapeHtml(e.mime_type)}">`;o=`\n            <video class="w-100 rounded rotatable-media rotate-${currentRotation}"\n                   preload="metadata" playsinline ${t} id="currentMediaElement">\n                ${a}\n                <p>„Åä‰Ωø„ÅÑ„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØ„Åì„ÅÆÂãïÁîªÂΩ¢Âºè„Çí„Çµ„Éù„Éº„Éà„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ</p>\n                <p><a href="${escapeHtml(e.file_path)}" download>ÂãïÁîª„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</a></p>\n            </video>\n        `}n.innerHTML=o;const l=document.getElementById("saveRotationBtn"),r=document.getElementById("rotationStatus");if(l&&(l.style.display="none"),r&&(r.textContent="",r.className="text-muted small ms-2"),"video"===e.file_type){const e=document.getElementById("currentMediaElement");e&&setupVideoProgressTracking(e)}else{const e=document.getElementById("videoProgressIndicator");e&&(e.style.display="none")}const s=translations[currentLanguage];let d='<div class="row g-3">';e.title||s["not-set"];d+=`\n        <div class="col-12">\n            <h6 class="mb-2"><i class="bi bi-tag-fill"></i> ${s["modal-title"]}</h6>\n            <div id="metadataTitleDisplay">\n                <p class="mb-0">${escapeHtml(e.title||"")}</p>\n            </div>\n        </div>\n    `;let c="";e.description?c=e.description:e.exif_location_name&&(c=`üìç ${e.exif_location_name}`),c&&(d+=`\n            <div class="col-12">\n                <h6 class="mb-2"><i class="bi bi-card-text"></i> ${s["modal-description"]}</h6>\n                <p class="mb-0">${escapeHtml(c)}</p>\n            </div>\n        `);if(e.exif_datetime||e.exif_latitude&&e.exif_longitude||e.exif_camera_make||e.exif_camera_model||isAdmin){if(d+='<div class="col-12"><hr class="my-2"></div>',d+=`\n            <div class="col-12">\n                <div class="d-flex align-items-center">\n                    <h6 class="mb-2"><i class="bi bi-info-circle"></i> ${s["exif-details"]}</h6>\n                    ${isAdmin?`<button type="button" class="btn btn-sm btn-outline-primary ms-3 mb-2" onclick="editMetadata()">\n                        <i class="bi bi-pencil-square"></i> ${s["edit-metadata"]||"„É°„Çø„Éá„Éº„Çø„ÇíÁ∑®ÈõÜ"}\n                    </button>`:""}\n                </div>\n            </div>\n        `,e.exif_datetime||isAdmin){const t=e.exif_datetime?formatDate(e.exif_datetime):`<span class="text-muted">${s["not-set"]}</span>`;d+=`\n                <div class="col-md-6">\n                    <small><strong><i class="bi bi-camera-fill"></i> ${s["exif-datetime"]}:</strong></small>\n                    <br>\n                    <div id="metadataDateDisplay">\n                        <small>${t}</small>\n                    </div>\n                </div>\n            `}if(e.exif_latitude&&e.exif_longitude||e.exif_location_name||isAdmin){let t="";if(e.exif_latitude&&e.exif_longitude){const a=parseFloat(e.exif_latitude),n=parseFloat(e.exif_longitude),i=`https://www.google.com/maps?q=${a},${n}`;e.exif_location_name&&(t=`<span x-apple-data-detectors="false" data-phone-skip="true">${escapeHtml(e.exif_location_name)}</span><br>`),t+=`\n                    <a href="${i}" target="_blank" rel="noopener noreferrer" class="text-decoration-none" x-apple-data-detectors="false" data-phone-skip="true">\n                        <span x-apple-data-detectors="false" data-phone-skip="true">üìç ${a.toFixed(6)}, ${n.toFixed(6)}</span>\n                        <i class="bi bi-box-arrow-up-right small"></i>\n                    </a>\n                `}else t=e.exif_location_name?`<span x-apple-data-detectors="false" data-phone-skip="true">${escapeHtml(e.exif_location_name)}</span>`:`<span class="text-muted">${s["not-set"]}</span>`;d+=`\n                <div class="col-md-6">\n                    <small><strong><i class="bi bi-geo-alt-fill"></i> ${s["exif-location"]}:</strong></small><br>\n                    <div id="metadataLocationDisplay" x-apple-data-detectors="false" data-phone-skip="true">\n                        <small>${t}</small>\n                    </div>\n                </div>\n            `}if(e.exif_camera_make||e.exif_camera_model){let t="";e.exif_camera_make&&(t+=escapeHtml(e.exif_camera_make)),e.exif_camera_model&&(t&&(t+=" "),t+=escapeHtml(e.exif_camera_model)),d+=`\n                <div class="col-md-6">\n                    <small><strong><i class="bi bi-camera2"></i> ${s["exif-camera"]||"„Ç´„É°„É©"}:</strong></small><br>\n                    <small>${t}</small>\n                </div>\n            `}}d+=`\n        <div class="col-md-6">\n            <small class="text-muted">\n                <i class="bi bi-file-earmark"></i> ${s["modal-filename"]} <span title="${escapeHtml(e.filename)}">${escapeHtml(truncateFilename(e.filename))}</span>\n            </small>\n        </div>\n        <div class="col-md-6">\n            <small class="text-muted">\n                <i class="bi bi-hdd"></i> ${s["modal-size"]} ${formatFileSize(e.file_size)}\n            </small>\n        </div>\n        <div class="col-md-6">\n            <small class="text-muted">\n                <i class="bi bi-calendar3"></i> ${s["modal-uploaded"]} ${formatDate(e.upload_date)}\n            </small>\n        </div>\n        <div class="col-md-6">\n            <small class="text-muted">\n                <i class="bi bi-file-code"></i> ${s["modal-format"]} ${escapeHtml(e.mime_type)}\n            </small>\n        </div>\n    `,isAdmin&&(d+=`\n            <div class="col-12" id="metadataEditForm" style="display: none;">\n                <div class="card border-primary">\n                    <div class="card-body">\n                        <h6 class="card-title mb-3">\n                            <i class="bi bi-pencil-square"></i> ${s["edit-metadata"]||"„É°„Çø„Éá„Éº„Çø„ÇíÁ∑®ÈõÜ"}\n                        </h6>\n\n                        \x3c!-- „Çø„Ç§„Éà„É´ --\x3e\n                        <div class="mb-3">\n                            <label for="metadataTitleInput" class="form-label small fw-bold">\n                                <i class="bi bi-tag-fill"></i> ${s["modal-title"]}\n                            </label>\n                            <input type="text" class="form-control" id="metadataTitleInput"\n                                   placeholder="${s["title-placeholder"]||"‰æã: ÂÆ∂ÊóèÊóÖË°å 2024"}">\n                        </div>\n\n                        \x3c!-- ÊíÆÂΩ±Êó• --\x3e\n                        <div class="mb-3">\n                            <label for="metadataDateInput" class="form-label small fw-bold">\n                                <i class="bi bi-camera-fill"></i> ${s["exif-datetime"]}\n                            </label>\n                            <input type="datetime-local" class="form-control" id="metadataDateInput">\n                        </div>\n\n                        \x3c!-- „É≠„Ç±„Éº„Ç∑„Éß„É≥Âêç --\x3e\n                        <div class="mb-3">\n                            <label for="metadataLocationNameInput" class="form-label small fw-bold">\n                                <i class="bi bi-geo-alt-fill"></i> ${s["exif-location"]||"‰ΩçÁΩÆÊÉÖÂ†±"}\n                            </label>\n                            <input type="text" class="form-control" id="metadataLocationNameInput"\n                                   placeholder="${s["location-placeholder"]||"‰æã: Êù±‰∫¨ÈÉΩÊ∏ãË∞∑Âå∫"}">\n                        </div>\n\n                        \x3c!-- GPSÂ∫ßÊ®ô --\x3e\n                        <div class="row">\n                            <div class="col-md-6 mb-3">\n                                <label for="metadataLatitudeInput" class="form-label small fw-bold">\n                                    ${s.latitude||"Á∑ØÂ∫¶"}\n                                </label>\n                                <input type="number" class="form-control" id="metadataLatitudeInput"\n                                       step="0.000001" min="-90" max="90"\n                                       placeholder="${s["latitude-placeholder"]||"‰æã: 35.658581"}">\n                            </div>\n                            <div class="col-md-6 mb-3">\n                                <label for="metadataLongitudeInput" class="form-label small fw-bold">\n                                    ${s.longitude||"ÁµåÂ∫¶"}\n                                </label>\n                                <input type="number" class="form-control" id="metadataLongitudeInput"\n                                       step="0.000001" min="-180" max="180"\n                                       placeholder="${s["longitude-placeholder"]||"‰æã: 139.745438"}">\n                            </div>\n                        </div>\n\n                        \x3c!-- „Éú„Çø„É≥ --\x3e\n                        <div class="d-flex gap-2 flex-wrap">\n                            <button type="button" class="btn btn-primary" id="saveMetadataBtn" onclick="saveMetadata()">\n                                <i class="bi bi-check-circle"></i> ${s.save||"‰øùÂ≠ò"}\n                            </button>\n                            <button type="button" class="btn btn-secondary" onclick="cancelEditMetadata()">\n                                <i class="bi bi-x-circle"></i> ${s.cancel}\n                            </button>\n                            ${"image/jpeg"===e.mime_type?`\n                            <button type="button" class="btn btn-info" id="writeExifBtn" onclick="writeExifToFile()">\n                                <i class="bi bi-file-earmark-code"></i> ${s["write-exif-to-file"]||"EXIF„Çí„Éï„Ç°„Ç§„É´„Å´Êõ∏„ÅçËæº„ÇÄ"}\n                            </button>\n                            `:""}\n                        </div>\n                        <span id="metadataStatus" class="small ms-2"></span>\n                        ${"image/jpeg"!==e.mime_type?`\n                        <div class="alert alert-info mt-2 mb-0" role="alert">\n                            <small><i class="bi bi-info-circle"></i> ${s["write-exif-only-jpeg"]||"JPEG„Éï„Ç°„Ç§„É´„ÅÆ„ÅøEXIFÊõ∏„ÅçËæº„Åø„Åå„Çµ„Éù„Éº„Éà„Åï„Çå„Å¶„ÅÑ„Åæ„Åô"}</small>\n                        </div>\n                        `:""}\n                    </div>\n                </div>\n            </div>\n        `),d+="</div>",i.innerHTML=d,t.show()}function setupVideoProgressTracking(e){const t=document.getElementById("videoProgressIndicator"),a=document.getElementById("videoProgressBar"),n=document.getElementById("videoProgressPercent"),i=document.getElementById("videoCurrentTime"),o=document.getElementById("videoDuration"),l=document.getElementById("playPauseIcon"),r=document.getElementById("muteIcon");function s(e){if(isNaN(e)||e<0)return"0:00";return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`}function d(){const t=e.currentTime,l=e.duration;if(l>0){const e=t/l*100;a.style.width=`${e}%`,n.textContent=Math.round(e),i.textContent=s(t),o.textContent=s(l)}}function c(){e.paused?l.className="bi bi-play-fill":l.className="bi bi-pause-fill"}function u(){e.muted?r.className="bi bi-volume-mute-fill":r.className="bi bi-volume-up-fill"}t&&e&&(t.style.display="block",e.addEventListener("loadedmetadata",()=>{o.textContent=s(e.duration),d(),c(),u()}),e.addEventListener("timeupdate",d),e.addEventListener("seeked",d),e.addEventListener("play",c),e.addEventListener("pause",c),e.addEventListener("volumechange",u),e.addEventListener("ended",()=>{a.style.width="100%",n.textContent="100",c()}),e.readyState>=1&&(o.textContent=s(e.duration),d()),c(),u())}function togglePlayPause(){const e=document.getElementById("currentMediaElement");e&&"VIDEO"===e.tagName&&(e.paused?e.play():e.pause())}function toggleMute(){const e=document.getElementById("currentMediaElement");e&&"VIDEO"===e.tagName&&(e.muted=!e.muted)}function seekVideo(e){const t=document.getElementById("currentMediaElement"),a=document.getElementById("videoProgressContainer");if(!t||!a||"VIDEO"!==t.tagName)return;const n=a.getBoundingClientRect(),i=(e.clientX-n.left)/n.width*t.duration;isNaN(i)||(t.currentTime=i)}function updateVideoProgressDisplay(e){const t=document.getElementById("videoProgressBar"),a=document.getElementById("videoProgressPercent"),n=document.getElementById("videoCurrentTime"),i=document.getElementById("videoDuration");if(!t||!e)return;function o(e){if(isNaN(e)||e<0)return"0:00";return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`}const l=e.currentTime,r=e.duration;if(r>0){const e=l/r*100;t.style.width=`${e}%`,a.textContent=Math.round(e),n.textContent=o(l),i.textContent=o(r)}}function deleteMedia(e,t,a){let n,i,o=null;e&&"object"==typeof e&&e.type?(o=e,n=t,i=a,o.preventDefault&&o.preventDefault(),o.stopPropagation&&o.stopPropagation(),o.stopImmediatePropagation&&o.stopImmediatePropagation()):(n=e,i=t);const l=translations[currentLanguage];if(!confirm(l["delete-confirm"].replace("{filename}",i)))return!1;const r=new URLSearchParams(window.location.search),s=r.get("page")||"1",d=r.get("filter")||"all",c=r.get("search")||"",u=r.get("sort")||"upload_date_desc",m=document.createElement("form");m.method="POST",m.action="delete.php";const f=document.createElement("input");f.type="hidden",f.name="media_id",f.value=n,m.appendChild(f);const p=document.createElement("input");p.type="hidden",p.name="current_page",p.value=s,m.appendChild(p);const g=document.createElement("input");if(g.type="hidden",g.name="filter",g.value=d,m.appendChild(g),c){const e=document.createElement("input");e.type="hidden",e.name="search",e.value=c,m.appendChild(e)}if(u){const e=document.createElement("input");e.type="hidden",e.name="sort",e.value=u,m.appendChild(e)}document.body.appendChild(m),m.submit()}function formatFileSize(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["Bytes","KB","MB","GB"][t]}function formatDate(e){const t=new Date(e);return`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`}function escapeHtml(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return String(e).replace(/[&<>"']/g,e=>t[e])}function truncateFilename(e,t=50){if(!e||e.length<=t)return e;const a=e.lastIndexOf(".");if(a>0&&a<e.length-1){const n=e.substring(0,a),i=e.substring(a),o=t-i.length-3;if(o>10){const e=Math.ceil(.6*o),t=Math.floor(.4*o);return n.substring(0,e)+"..."+n.substring(n.length-t)+i}}return e.substring(0,t-3)+"..."}function initTooltips(){[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map(function(e){return new bootstrap.Tooltip(e)})}async function convertHeicFilesToJpeg(e){const t=[];if("undefined"==typeof heic2any)return e;for(const a of e){const e=a.name.toLowerCase();if(e.endsWith(".heic")||e.endsWith(".heif"))try{let e=null;try{const t=await a.arrayBuffer();new DataView(t);if("undefined"!=typeof piexif)try{e=null}catch(e){}}catch(e){}const n=await heic2any({blob:a,toType:"image/jpeg",quality:.9}),i=a.name.replace(/\.(heic|heif)$/i,".jpg"),o=new File([n],i,{type:"image/jpeg",lastModified:a.lastModified});t.push(o)}catch(e){const n=translations[currentLanguage];alert(n["heic-conversion-failed"].replace("{filename}",a.name)),t.push(a)}else t.push(a)}const a=new DataTransfer;t.forEach(e=>a.items.add(e));const n=document.getElementById("mediaFile");return n&&(n.files=a.files),t}async function uploadFileInChunks(e,t,a,n=3){const i=1048576,o=Math.ceil(e.size/i);let l=0;for(let r=0;r<o;r++){const s=r*i,d=Math.min(s+i,e.size),c=e.slice(s,d);let u=!1,m=0;for(;!u&&m<n;)try{const n=new FormData;n.append("chunk",c),n.append("chunkIndex",r),n.append("totalChunks",o),n.append("fileName",e.name),n.append("fileIdentifier",t);const i=await fetch("lib/chunk_upload.php",{method:"POST",body:n});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const s=await i.json();if(!s.success)throw new Error(s.error||"„ÉÅ„É£„É≥„ÇØ„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂ§±Êïó");l=d,a&&a(l,e.size),u=!0}catch(e){if(m++,console.error(`„ÉÅ„É£„É≥„ÇØ ${r} „ÅÆ„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂ§±Êïó (Ë©¶Ë°å ${m}/${n}):`,e),m>=n)throw new Error(`„ÉÅ„É£„É≥„ÇØ ${r} „ÅÆ„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ${e.message}`);const t=Math.min(1e3*Math.pow(2,m-1),1e4);await new Promise(e=>setTimeout(e,t))}}return!0}async function finalizeFileUpload(e,t,a,n,i){const o=new FormData;o.append("fileIdentifier",e),o.append("title",t||""),o.append("description",a||""),n&&o.append("thumbnailData",n),i&&o.append("exifData",JSON.stringify(i));const l=await fetch("lib/finalize_upload.php",{method:"POST",body:o});if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);return await l.json()}async function uploadMultipleFiles(e,t,a,n,i){const o=document.querySelector("#uploadProgress .progress-bar"),l=document.getElementById("uploadBtn"),r=Array.from(e).reduce((e,t)=>e+t.size,0);let s=0;const d={success:[],errors:[]};for(let c=0;c<e.length;c++){const u=e[c],m=`${Date.now()}_${c}_${Math.random().toString(36).substr(2,9)}`;try{const f=translations[currentLanguage];l&&(l.innerHTML=`<span class="spinner-border spinner-border-sm me-2"></span>${f["uploading-count"].replace("{current}",c+1).replace("{total}",e.length)}`);const p=s;await uploadFileInChunks(u,m,(e,t)=>{const a=p+e,n=Math.min(100,Math.round(a/r*100));o&&(o.style.width=n+"%",o.textContent=n+"%")}),s+=u.size;const g=n.get(u.name)||null,h=i&&i.get(u.name)||null,b=await finalizeFileUpload(m,t,a,g,h);b.success?d.success.push(u.name):d.errors.push(`${u.name}: ${b.error}`)}catch(e){console.error(`„Éï„Ç°„Ç§„É´ ${u.name} „ÅÆ„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂ§±Êïó:`,e),d.errors.push(`${u.name}: ${e.message}`),s+=u.size;const t=Math.min(100,Math.round(s/r*100));o&&(o.style.width=t+"%",o.textContent=t+"%")}}return d}function rotateMedia(e){if(!currentMedia)return;const t=translations[currentLanguage],a=document.getElementById("currentMediaElement"),n=document.getElementById("saveRotationBtn"),i=document.getElementById("rotationStatus");a&&n&&i&&(currentRotation=(currentRotation+e+360)%360,a.className=a.className.replace(/rotate-\d+/,`rotate-${currentRotation}`),n.style.display="inline-block",i.textContent=t["rotation-changed"],i.classList.add("text-warning"))}async function saveRotation(){if(!currentMedia)return;const e=translations[currentLanguage],t=document.getElementById("saveRotationBtn"),a=document.getElementById("rotationStatus");if(t&&a){t.disabled=!0,t.innerHTML=`<span class="spinner-border spinner-border-sm me-1"></span>${e.saving}`;try{const t=await fetch("api/update_rotation.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({media_id:currentMedia.id,rotation:currentRotation})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const n=await t.json();if(!n.success)throw new Error(n.error||e["save-failed"]);a.textContent=e["rotation-saved"],a.classList.remove("text-warning"),a.classList.add("text-success"),currentMedia.rotation=currentRotation,console.log("ÂõûËª¢Ë®≠ÂÆö„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü:",n),setTimeout(()=>{window.location.reload()},1e3)}catch(t){console.error("ÂõûËª¢Ë®≠ÂÆö„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó:",t),a.textContent=e["rotation-save-error"],a.classList.remove("text-warning"),a.classList.add("text-danger"),setTimeout(()=>{a.textContent=e["rotation-changed"],a.classList.remove("text-danger"),a.classList.add("text-warning")},3e3)}finally{t.disabled=!1,t.innerHTML='<i class="bi bi-check-circle"></i> <span data-i18n="save-rotation">'+e["save-rotation"]+"</span>"}}}function saveFilterSortSettings(e,t,a){try{localStorage.setItem("kidsnaps-filter",e||"all"),localStorage.setItem("kidsnaps-sort",t||"upload_date_desc"),localStorage.setItem("kidsnaps-search",a||"")}catch(e){console.warn("localStorage‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:",e)}}function loadFilterSortSettings(){try{return{filter:localStorage.getItem("kidsnaps-filter")||"all",sort:localStorage.getItem("kidsnaps-sort")||"upload_date_desc",search:localStorage.getItem("kidsnaps-search")||""}}catch(e){return console.warn("localStorageË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:",e),{filter:"all",sort:"upload_date_desc",search:""}}}function restoreFilterSortSettings(){if(!window.location.pathname.endsWith("index.php")&&!window.location.pathname.endsWith("/"))return;const e=new URLSearchParams(window.location.search),t=e.has("filter"),a=e.has("sort"),n=e.has("search");if(t||a||n){return void saveFilterSortSettings(e.get("filter")||"all",e.get("sort")||"upload_date_desc",e.get("search")||"")}const i=loadFilterSortSettings();if("all"!==i.filter||"upload_date_desc"!==i.sort||""!==i.search){const e=new URLSearchParams(window.location.search);"all"!==i.filter&&e.set("filter",i.filter),"upload_date_desc"!==i.sort&&e.set("sort",i.sort),""!==i.search&&e.set("search",i.search),e.delete("page");const t=window.location.pathname+"?"+e.toString();t!==window.location.pathname+window.location.search&&(window.location.href=t)}}function setupFilterSortFormListeners(){if(!window.location.pathname.endsWith("index.php")&&!window.location.pathname.endsWith("/"))return;const e=document.querySelector('form[action="index.php"]');if(!e)return;const t=e.querySelector('select[name="filter"]'),a=e.querySelector('select[name="sort"]'),n=e.querySelector('input[name="search"]');e.addEventListener("submit",function(e){saveFilterSortSettings(t?t.value:"all",a?a.value:"upload_date_desc",n?n.value:"")}),t&&t.addEventListener("change",function(){saveFilterSortSettings(t.value,a?a.value:"upload_date_desc",n?n.value:"")}),a&&a.addEventListener("change",function(){saveFilterSortSettings(t?t.value:"all",a.value,n?n.value:"")})}function editPhotoDate(){if(!currentMedia)return;const e=document.getElementById("photoDateDisplay"),t=document.getElementById("photoDateEdit");if(!e||!t)return;const a=document.getElementById("photoDateInput");if(currentMedia.exif_datetime){const e=currentMedia.exif_datetime.replace(" ","T").substring(0,16);a.value=e}else a.value="";e.style.display="none",t.style.display="block",a.focus()}function cancelEditPhotoDate(){const e=document.getElementById("photoDateDisplay"),t=document.getElementById("photoDateEdit");e&&t&&(e.style.display="block",t.style.display="none")}function savePhotoDate(){if(!currentMedia)return;const e=translations[currentLanguage],t=document.getElementById("photoDateInput"),a=document.getElementById("savePhotoDateBtn"),n=document.getElementById("photoDateStatus"),i=t.value;a&&(a.disabled=!0,a.innerHTML=`<i class="bi bi-hourglass-split"></i> ${e["saving-in-progress"]}`),fetch("api/update_photo_date.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({media_id:currentMedia.id,exif_datetime:i})}).then(e=>e.json()).then(t=>{if(!t.success)throw new Error(t.error||e["save-failed"]);{n&&(n.textContent=e["saved-successfully"],n.className="text-success small ms-2",setTimeout(()=>{n.textContent=""},3e3)),currentMedia.exif_datetime=t.exif_datetime;const a=document.getElementById("photoDateDisplay");a&&(t.exif_datetime?a.innerHTML=`<small>${formatDate(t.exif_datetime)}</small>`:a.innerHTML=`<small class="text-muted">${e["not-set"]}</small>`),cancelEditPhotoDate(),setTimeout(()=>{location.reload()},1e3)}}).catch(t=>{console.error("ÊíÆÂΩ±Êó•‰øùÂ≠ò„Ç®„É©„Éº:",t),n&&(n.textContent="‚úó "+t.message,n.className="text-danger small ms-2"),alert(e["update-photo-date-error"]+": "+t.message)}).finally(()=>{a&&(a.disabled=!1,a.innerHTML=`<i class="bi bi-check-circle"></i> ${e["photo-date-save"]}`)})}function editMetadata(){if(!currentMedia)return;const e=document.getElementById("metadataEditForm");if(!e)return;const t=document.getElementById("metadataTitleInput"),a=document.getElementById("metadataDateInput"),n=document.getElementById("metadataLocationNameInput"),i=document.getElementById("metadataLatitudeInput"),o=document.getElementById("metadataLongitudeInput");if(t&&(t.value=currentMedia.title||""),a)if(currentMedia.exif_datetime){const e=currentMedia.exif_datetime.replace(" ","T").substring(0,16);a.value=e}else a.value="";n&&(n.value=currentMedia.exif_location_name||""),i&&(i.value=currentMedia.exif_latitude||""),o&&(o.value=currentMedia.exif_longitude||""),e.style.display="block",e.scrollIntoView({behavior:"smooth",block:"nearest"})}function cancelEditMetadata(){const e=document.getElementById("metadataEditForm");e&&(e.style.display="none")}function saveMetadata(){if(!currentMedia)return;const e=translations[currentLanguage],t=document.getElementById("metadataTitleInput"),a=document.getElementById("metadataDateInput"),n=document.getElementById("metadataLocationNameInput"),i=document.getElementById("metadataLatitudeInput"),o=document.getElementById("metadataLongitudeInput"),l=document.getElementById("saveMetadataBtn"),r=document.getElementById("metadataStatus"),s=t?t.value:"",d=a?a.value:"",c=n?n.value:"",u=i?i.value:"",m=o?o.value:"";l&&(l.disabled=!0,l.innerHTML=`<i class="bi bi-hourglass-split"></i> ${e["saving-in-progress"]||"‰øùÂ≠ò‰∏≠..."}`);const f={media_id:currentMedia.id,title:s,exif_datetime:d,exif_location_name:c,exif_latitude:u,exif_longitude:m};fetch("api/update_metadata.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)}).then(e=>e.json()).then(t=>{if(!t.success)throw new Error(t.error||e["save-failed"]||"‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü");r&&(r.textContent=e["saved-successfully"]||"‰øùÂ≠ò„Åó„Åæ„Åó„Åü",r.className="text-success small ms-2",setTimeout(()=>{r.textContent=""},3e3)),t.data&&(currentMedia.title=t.data.title,currentMedia.exif_datetime=t.data.exif_datetime,currentMedia.exif_location_name=t.data.exif_location_name,currentMedia.exif_latitude=t.data.exif_latitude,currentMedia.exif_longitude=t.data.exif_longitude),updateMetadataDisplay(),cancelEditMetadata(),setTimeout(()=>{location.reload()},1e3)}).catch(t=>{console.error("„É°„Çø„Éá„Éº„Çø‰øùÂ≠ò„Ç®„É©„Éº:",t),r&&(r.textContent="‚úó "+t.message,r.className="text-danger small ms-2"),alert((e["update-metadata-error"]||"„É°„Çø„Éá„Éº„Çø„ÅÆÊõ¥Êñ∞„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")+": "+t.message)}).finally(()=>{l&&(l.disabled=!1,l.innerHTML=`<i class="bi bi-check-circle"></i> ${e.save||"‰øùÂ≠ò"}`)})}function writeExifToFile(){if(!currentMedia)return;const e=translations[currentLanguage];if("image/jpeg"!==currentMedia.mime_type)return void alert(e["write-exif-only-jpeg"]||"JPEG„Éï„Ç°„Ç§„É´„ÅÆ„Åø„Çµ„Éù„Éº„Éà„Åï„Çå„Å¶„ÅÑ„Åæ„Åô");if(!confirm(e["write-exif-confirm"]||"ÁèæÂú®„ÅÆ„É°„Çø„Éá„Éº„Çø„ÇíEXIFÊÉÖÂ†±„Å®„Åó„Å¶ÁîªÂÉè„Éï„Ç°„Ç§„É´„Å´Êõ∏„ÅçËæº„Åø„Åæ„Åô„ÅãÔºü\n\n‚ÄªÁîªÂÉè„Éï„Ç°„Ç§„É´Ëá™‰Ωì„ÇíÁâ©ÁêÜÁöÑ„Å´Â§âÊõ¥„Åó„Åæ„Åô„ÄÇ"))return;const t=document.getElementById("writeExifBtn"),a=document.getElementById("metadataStatus");t&&(t.disabled=!0,t.innerHTML=`<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>${e["write-exif-writing"]||"EXIFÊõ∏„ÅçËæº„Åø‰∏≠..."}`),fetch("api/write_exif_to_file.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({media_id:currentMedia.id})}).then(e=>e.json()).then(t=>{if(!t.success)throw new Error(t.error||e["write-exif-error"]||"EXIF„Éá„Éº„Çø„ÅÆÊõ∏„ÅçËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü");a&&(a.textContent="‚úì "+(e["write-exif-success"]||"EXIF„Éá„Éº„Çø„Çí„Éï„Ç°„Ç§„É´„Å´Êõ∏„ÅçËæº„Åø„Åæ„Åó„Åü"),a.className="text-success small ms-2",setTimeout(()=>{a.textContent=""},5e3)),alert(e["write-exif-success"]||"EXIF„Éá„Éº„Çø„Çí„Éï„Ç°„Ç§„É´„Å´Êõ∏„ÅçËæº„Åø„Åæ„Åó„Åü"),setTimeout(()=>{location.reload()},1e3)}).catch(t=>{console.error("EXIFÊõ∏„ÅçËæº„Åø„Ç®„É©„Éº:",t),a&&(a.textContent="‚úó "+t.message,a.className="text-danger small ms-2"),alert((e["write-exif-error"]||"EXIF„Éá„Éº„Çø„ÅÆÊõ∏„ÅçËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")+":\n"+t.message)}).finally(()=>{t&&(t.disabled=!1,t.innerHTML=`<i class="bi bi-file-earmark-code"></i> ${e["write-exif-to-file"]||"EXIF„Çí„Éï„Ç°„Ç§„É´„Å´Êõ∏„ÅçËæº„ÇÄ"}`)})}function updateMetadataDisplay(){const e=translations[currentLanguage],t=document.getElementById("metadataTitleDisplay");t&&(t.innerHTML=currentMedia.title?`<p class="mb-0">${escapeHtml(currentMedia.title)}</p>`:"");const a=document.getElementById("metadataDateDisplay");if(a){const t=currentMedia.exif_datetime?formatDate(currentMedia.exif_datetime):`<span class="text-muted">${e["not-set"]}</span>`;a.innerHTML=`<small>${t}</small>`}const n=document.getElementById("metadataLocationDisplay");if(n){let t="";if(currentMedia.exif_latitude&&currentMedia.exif_longitude){const e=parseFloat(currentMedia.exif_latitude),a=parseFloat(currentMedia.exif_longitude),n=`https://www.google.com/maps?q=${e},${a}`;currentMedia.exif_location_name&&(t=`${escapeHtml(currentMedia.exif_location_name)}<br>`),t+=`\n                <a href="${n}" target="_blank" rel="noopener noreferrer" class="text-decoration-none">\n                    üìç ${e.toFixed(6)}, ${a.toFixed(6)}\n                    <i class="bi bi-box-arrow-up-right small"></i>\n                </a>\n            `}else t=currentMedia.exif_location_name?escapeHtml(currentMedia.exif_location_name):`<span class="text-muted">${e["not-set"]}</span>`;n.innerHTML=`<small>${t}</small>`}}async function convertHeicThumbnails(){const e=document.querySelectorAll("img.media-thumbnail");for(const t of e){const e=t.src||t.getAttribute("data-src")||"";if(e.match(/\.(heic|heif)$/i))try{const a=await fetch(e),n=await a.blob(),i=await heic2any({blob:n,toType:"image/jpeg",quality:.8}),o=URL.createObjectURL(i);t.src=o,window.heicThumbnailUrls||(window.heicThumbnailUrls=[]),window.heicThumbnailUrls.push(o),console.log(`Converted HEIC thumbnail: ${e}`)}catch(a){console.error(`Failed to convert HEIC thumbnail: ${e}`,a),t.alt="HEIC image (conversion failed)"}}}setTimeout(()=>{document.querySelectorAll(".alert").forEach(e=>{const t=new bootstrap.Alert(e);setTimeout(()=>{t.close()},5e3)})},500),document.addEventListener("DOMContentLoaded",function(){restoreFilterSortSettings(),setupFilterSortFormListeners()}),document.addEventListener("DOMContentLoaded",function(){function e(e){const t=e.target.closest(".delete-media-btn");if(t){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const a=t.getAttribute("data-media-id"),n=t.getAttribute("data-filename");return a&&n&&deleteMedia(e,a,n),!1}}document.addEventListener("click",e,!0),document.addEventListener("touchend",e,!0),convertHeicThumbnails()});